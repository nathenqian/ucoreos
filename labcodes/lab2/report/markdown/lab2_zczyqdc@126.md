#操作系统第二次实验报告
钱迪晨 2013011402 计35
##练习1
###题目1
简述我的内存分配算法，你的first fit算法是否有进一步的改进空间？

答：我采用的是链表维护Page数据结构。每次链表中只有连续块开始的Page，这样开始的时候我的链表大小只有1.

每次分配的时候，会把一块内存，分裂成一块小的，以及分配出去的内存。

free的时候则需要将free的内存向前和向后合并。

我觉得自己的算法可以优化的地方在于链表查找比较慢，可以使用跳表优化，是的查找和修改复杂度为log级别。

###题目2
请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。
如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

答：pde和pte的最低位是PTE_P，表示这块内存是否存在。

最低2位是PTE_W，表示内存是否可写。

最低3位是PTE_U，表示用户是否可访问。

高20为是下一级的物理地址，用来寻址用的。

如果出现了页访问异常，如果该页不在内存但在外存中，则应该把该页调回内存，硬件和操作系统一起维护。

否则则是异常访问，操作系统应该进行处理。

###题目3
数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是啥？
如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ 

答：有关系，页表项存储的其实是下一级页表的物理地址。我们用Page数据结构来描述4K的物理地址，所以说每次我们新建一个页表项的时候，实际上拿到的是一个Page变量，再用Page变量计算出物理地址。

如果是liner addr = phy addr，我们考虑两个阶段。

第一个阶段页表还没有启用的时候，此时由于gdt的设置，vir addr = liner addr + 0xc0000000，这个时候只需要在建立初始化页表的时候进行对等映射即可。

第二个阶段页表启用了，在get_pte函数里面需要修改。

	memset(KADDR(page2pa(page)), 0, PGSIZE);改为
	memset(page2pa(page), 0, PGSIZE);
	return (pte_t *)(&(((pte_t*)KADDR(PDE_ADDR(*pdep))))[PTX(la)]);改为
	return (pte_t *)(&(((pte_t*)(PDE_ADDR(*pdep))))[PTX(la)]);


##和提供答案的区别
- 分配页的时候，我是一块块的维护，不是每个page一下子全部加入链表进行维护，这样会快。

##重要知识点
page的建立，以及vir addr liner addr 和phy addr的转换。